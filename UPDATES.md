
# üß† QSF Generator - General Notes

---

## üìÑ Overview

The **QSF Generator** is a simple, client-side HTML tool designed to generate Qualtrics QSF files for M2C2 tasks. It is:

- Easy to run (just open the HTML file‚Äîno server required)
- Simple to update
- Built for non-technical users with a straightforward interface

---

## üåê Key Technologies

- **HTML/JavaScript** (runs entirely in-browser)
- **SweetAlert2** for user notifications
- **SortableJS** for drag-and-drop task reordering

---

## üìÇ Project Structure

- **Instructions/Configuration Section**
  Located at the top of the HTML file and contains:
  - Intro text
  - Instructions
  - Recommended settings

- **Task List UI**
  An unordered list (`<ul>`) with:
  - `id="sortableTasks"`
  - `class="task-list"`
  *(required for SortableJS to function)*

- **Form Inputs**
  - Number of trials (input field)
  - Additional parameters (textarea)

- **JavaScript Functions**
  - `generateQSF()`: Generates the QSF output.
  - `updateFlow()`: Modifies QSF content programmatically.

---

## üîÅ How to Update the QSF Generator

### 1. Pull the Latest Code

Using ```git clone https://github.com/m2c2-project/qualtrics-qsf-generator.git``` or Download ZIP - be sure to pull your desired branch!

Please be sure to update the QSF generator version so that we can easily track which version of the generator was used inside the data.

---

## üåç Adding/Updating Languages

To add a new language option in the QSF Generator interface:

1. Open the HTML file in a text editor.
2. Find the `<select>` element with the name `m2c2Language`.
3. Add a new `<option>` tag with the correct language code and label, like this:

```html
<option value="fr-CA">French (Canada)</option>
```

- **Value attribute:** Must match the language code used by the tasks (e.g., `en-US`, `es-MX`, `fr-CA`).
- **Displayed label:** Should be the human-readable language name.

4. Update any JavaScript inside the QSF template if task versions, text, or behavior should change based on the language.
5. Refer to the section **Editing JavaScript Inside the QSF** to make those language-dependent adjustments.

---

## ‚ûï Adding New Embedded Fields

### Option A: Static Fields

These are fields that don‚Äôt change dynamically with the number of tasks or trials.

Steps:

1. Generate a default QSF using the generator.
2. Import it into Qualtrics.
3. In **Survey Flow**, add your new embedded field.
4. Optionally update the `generateQSF()` function to include the field and default value automatically.

### Option B: Dynamic Fields

These depend on the number of tasks or trials selected by the user.

Steps:

1. Modify the `generateQSF()` function to calculate or inject your new field.
2. Add or update the `updateFlow()` function to handle the logic for your new fields.
3. Locate and update the `for` loop at the bottom of `generateQSF()` that applies `updateFlow()` for each task/trial as needed.

---

## ‚úèÔ∏è Editing JavaScript Inside the QSF

Sometimes, you‚Äôll need to change JavaScript that is embedded directly in the QSF file to:

- Update task versions or libraries
- Customize how M2C2 tasks appear on the page
- Modify embedded field behavior
- Add debug or troubleshooting features

### Recommended Workflow:

1. Open Qualtrics.
2. Import a generic QSF file generated by this tool.
3. On **Q1**, click the `</>` (JavaScript) icon in the top right corner.
4. Copy the JavaScript into a real code editor (Qualtrics‚Äô editor has limitations).
5. Make your edits.
6. Thoroughly test your changes in the Qualtrics preview environment.
7. Once finalized, export your survey:
   - Go to **Tools ‚Üí Import/Export ‚Üí Export Survey**
8. Open the `.qsf` file in a code/text editor.
9. Copy the updated JavaScript code block into the QSF Generator HTML file, replacing the appropriate template string section.

> ‚ö†Ô∏è **Important:** Qualtrics only allows a limited subset of JavaScript.

## Verifying QSF

After you have completed your edits, you should test importing generated QSF files thoroughly. It is important to check the following:

- QSF imports successfully
- Review embedded data variables:
  - ```M2C2_PARTICIPANT_ID```, ```M2C2_SESSION_ID```, ```M2C2_GROUP_ID```, ```M2C2_WAVE_ID```, ```M2C2_ASSESSMENT_XX_TRIAL_DATA_XX```, and ```M2C2_ASSESSMENT_XX_SCORING_DATA_XX``` all display as ```Value will be set from Panel or URL.```
    - If these are not displaying correctly, the value may not update across participants/trial/task completions.

## Production Mode

‚ö†Ô∏è **Important:** After you have finished testing your generated QSF, we recommend updating the survey flow embedded data variable ```M2C2_DEBUG``` to ```FALSE```

## Other Notes

When reviewing the QSF JSON blob, you may notice that embedded data variables contain fields for description, type, field, variable type, data visibility, analyze text, and value. If the type is Custom, and no value is provided then you may have difficulty later changing the value from within Qualtrics. It seems as thoug you cannot change it, but if you click on the embedded data variable name and hit tab on your keyboard it should allow you to modify it. For most variables you can change after importing into Qualtrics if desired, however, it is important that the number of trials matches the number of embedded data variables for that specific task.
